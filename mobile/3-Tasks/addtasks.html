<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeeMazing Add Task</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
    --primary-color: #E0B018; /* softened gold */
    --secondary-color: #212121;
    --accent-color: #2C2F3A;
    --light-bg: #1E1F26;
    --text-color: #FFFFFF;
    --danger-color: #D32F2F;
    --muted-button: #3A3D4B;
    --hover-accent: #3F4353;
    --border-dark: #444754; /* subtle dark gray-blue border */
    --selection-border: #555555; /* darker gray border for selected states */
    --selection-bg: #3A3D4B;      /* muted highlight */
}


    html, body {
        height: 100%;
        width: 100%;
        overflow-x: hidden;
        font-family: 'Poppins', Arial, sans-serif;
        background-color: var(--light-bg);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
    }

    .header {
    position: relative;
    display: flex;
    justify-content: center; /* Center the title */
    align-items: center;
    background: var(--secondary-color);
    padding: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
}

.menu-icon {
    position: absolute;
    left: 15px;
    font-size: 24px;
    color: var(--text-color); /* fix: use white instead of black */
    cursor: pointer;
}

    .title {
    font-size: 24px;
    font-weight: 600;
    color: var(--text-color); /* white text */
    text-transform: uppercase;
    letter-spacing: 1px;
}

    .content {
        padding: 20px;
        padding-bottom: 110px;
        flex: 1;
        overflow-y: auto;
    }

    .form-group, .form-group-full {
    padding: 15px 0;
    border-bottom: 1px solid var(--border-dark); /* subtle divider */
}


    .form-group {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    label {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-color);
    }

    input, textarea {
    background: var(--accent-color);
    color: var(--text-color);
    border: 2px solid var(--border-dark);
    border-radius: 8px;
    padding: 10px;
    font-size: 16px;
    width: 100%; /* 👈 Add this line to make inputs full width */
}


    textarea {
        resize: vertical;
        height: 100px;
    }

    ::placeholder {
        color: rgba(255, 255, 255, 0.6);
    }

    .select-btn {
    background: var(--muted-button);
    border: 2px solid var(--border-dark);
    color: var(--text-color);
    font-size: 16px;
    font-weight: 600;
    padding: 8px 15px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
}

    .select-btn:hover {
        background: #FFB300;
    }

    .date-display {
        background: var(--accent-color);
        border: 2px solid var(--border-dark);
        border-radius: 8px;
        padding: 10px 15px;
        font-size: 16px;
        font-weight: 600;
        color: var(--text-color);
        text-align: center;
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .date-display:hover {
        background: var(--primary-color);
        color: var(--secondary-color);
    }

    .date-flex-row {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .date-flex-row label {
        width: 80px;
        margin: 0;
    }

    .date-controls {
        display: flex;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
    }

    .date-input {
        display: none;
    }

    .save-btn {
        width: 100%;
        padding: 15px;
        margin-top: 20px;
        background: var(--primary-color);
        color: var(--secondary-color);
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .save-btn:hover {
        background: #FFB300;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .modal.show {
        display: flex;
        animation: fadeIn 0.3s ease-out;
    }

    .modal.hide {
        animation: fadeOut 0.3s ease-out;
        pointer-events: none;
    }

    .modal-content {
        background: var(--accent-color);
        padding: 20px;
        border-radius: 15px;
        border: 2px solid var(--primary-color);
        width: 80%;
        max-width: 400px;
        text-align: center;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        color: var(--text-color);
    }

    .modal-content h3 {
        color: var(--text-color);
        font-weight: 600;
        margin-bottom: 15px;
    }

    .modal-content ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .modal-content ul li {
        padding: 10px;
        margin: 5px 0;
        background: var(--light-bg);
        color: var(--text-color);
        border: 2px solid var(--border-dark);
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .modal-content ul li:hover {
        background: var(--primary-color);
        color: var(--secondary-color);
    }

    .close-btn {
        margin-top: 15px;
        padding: 10px 20px;
        background: var(--danger-color);
        color: var(--text-color);
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .close-btn:hover {
        background: #B71C1C;
    }

    .footer {
    position: fixed;
    bottom: 0;
    width: 100%;
    display: flex;
    justify-content: space-around;
    background: var(--secondary-color); /* Changed to black */
    padding: 10px 0;
    box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
    z-index: 100;
    height: var(--footer-height);
}

.footer a {
    text-decoration: none;
    color: var(--accent-color); /* Changed to white for text */
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.3s ease;
}




    .footer img {
        width: 40px;
        height: 40px;
        filter: invert(100%) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2)); /* Default: white */
    }

    .switch {
        position: relative;
        display: inline-block;
        width: 34px;
        height: 20px;
    }

    .switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #444;
        transition: 0.4s;
        border-radius: 20px;
    }

    .slider:before {
        position: absolute;
        content: "";
        height: 14px;
        width: 14px;
        left: 3px;
        bottom: 3px;
        background-color: var(--accent-color);
        transition: 0.4s;
        border-radius: 50%;
    }

    input:checked + .slider {
        background-color: var(--primary-color);
    }

    input:checked + .slider:before {
        transform: translateX(14px);
    }

    .fancy-input {
        padding: 8px 12px;
        font-size: 14px;
        border: 2px solid var(--border-dark);
        border-radius: 8px;
        background: var(--light-bg);
        color: var(--text-color);
        width: 80%;
        margin: 0 auto;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .fancy-input:focus {
        border-color: #FFB300;
        box-shadow: 0 4px 12px rgba(255, 193, 7, 0.5);
        outline: none;
    }

    .btn-save {
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        background: var(--primary-color);
        color: var(--secondary-color);
        border: none;
        border-radius: 20px;
        cursor: pointer;
        transition: transform 0.2s ease, background-color 0.3s ease;
    }

    .btn-save:hover {
        transform: translateY(-3px);
        background: #FFB300;
    }

    .btn-cancel {
        padding: 10px 20px;
        font-size: 14px;
        font-weight: 600;
        background: var(--danger-color);
        color: var(--text-color);
        border: none;
        border-radius: 20px;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .btn-cancel:hover {
        background: #B71C1C;
        transform: translateY(-3px);
    }

    @keyframes fadeIn {
        0% { opacity: 0; transform: scale(0.9); }
        100% { opacity: 1; transform: scale(1); }
    }

    @keyframes fadeOut {
        0% { opacity: 1; transform: scale(1); }
        100% { opacity: 0; transform: scale(0.9); }
    }

    @keyframes slideIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }
</style>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="header">
        <i class="fas fa-bars menu-icon"></i>
        <div class="title">Add Task</div>
    </div>

    <div class="content">
        <form id="addTaskForm">
            <div class="form-group-full">
                <label for="taskTitle"></label>
                <input type="text" id="taskTitle" placeholder="Enter task title" required>
            </div>
            <div class="form-group-full">
                <label for="taskNotes"></label>
                <textarea id="taskNotes" placeholder="Enter any additional notes"></textarea>
            </div>
            <div class="form-group">
                <label>Room</label>
                <button type="button" id="selectRoom" class="select-btn">Select</button>
                <input type="hidden" id="roomSelection" value="">
            </div>
            <div class="form-group">
                <label>Frequency</label>
                <button type="button" id="selectRepeat" class="select-btn">Select</button>
                <input type="hidden" id="repeatSelection" value="">
            </div>
            
            <!-- NEW: Times Per Day input (only shown when Daily is selected) -->
            <div class="form-group" id="timesPerDayGroup" style="display: none;">
                <label>Times per Day</label>
                <input type="text" id="timesPerDayInput" value="1" readonly
    style="width: 60px; text-align: center; padding: 6px; border: 2px solid var(--primary-color); border-radius: 8px; background: var(--accent-color); font-size: 16px; cursor: pointer;">
            </div>

            <!-- Weekly Frequency Input -->
<div class="form-group" id="timesPerWeekGroup" style="display: none;">
    <label>Times per Week</label>
    <input type="text" id="timesPerWeekInput" value="1" readonly
    style="width: 60px; text-align: center; padding: 6px; border: 2px solid var(--primary-color); border-radius: 8px; background: var(--accent-color); font-size: 16px; cursor: pointer;">
    

</div>

<!-- Monthly Frequency Input -->
<div class="form-group" id="timesPerMonthGroup" style="display: none;">
    <label>Times per Month</label>
    <input type="text" id="timesPerMonthInput" value="1" readonly
style="width: 60px; text-align: center; padding: 6px; border: 2px solid var(--primary-color); border-radius: 8px; background: var(--accent-color); font-size: 16px; cursor: pointer;">


</div>

            
            <div class="form-group">
                <label>Settings</label>
                <button type="button" id="selectSettings" class="select-btn">Select</button>
                <input type="hidden" id="settingsSelection" value="">
            </div>
            <div class="form-group date-flex-row">
                <label>Date</label>
                <div class="date-controls">
                    <button type="button" id="dateModeToggle" class="select-btn">From</button>
                    <div id="dateDisplay" class="date-display">Today</div>
                    <div id="dateDisplayTo" class="date-display" style="display: none;">To Date</div>
                </div>
                <input type="text" id="taskDate" class="date-input" />
                <input type="text" id="taskDateTo" class="date-input" />
            </div>
            
            <div class="form-group">
                <label>Reminder</label>
                <label class="switch">
                    <input type="checkbox" id="taskReminder">
                    <span class="slider"></span>
                </label>
                <button type="button" id="addAlarmBtn" class="select-btn" style="display: none; margin-left: 10px;">+ Add Alarm</button>
            </div>
            <div id="alarmContainer" style="margin-top: 10px;"></div>
            <div class="form-group">
                <label>
                    <span id="assignedToDisplay" class="select-btn">Select users</span>
                    <input type="hidden" id="assignedToSelection" value="">
                </label>
            </div>
            <div class="form-group">
                <label>
                    <span id="selectReward" class="select-btn">Reward</span>
                    <input type="hidden" id="RewardValue" value="">
                </label>
                <div class="modal" id="rewardModal">
                    <div class="modal-content fancy-modal">
                        <h3>Reward 🍯</h3>
                        <input type="number" id="rewardInput" placeholder="      Enter Honey Amount" min="1" class="fancy-input smaller-input">
                        <div style="margin-top: 10px;">
                            <button id="saveRewardBtn" class="btn-save">Save</button>
                            <button id="closeRewardModal" class="btn-cancel">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
            <button type="submit" class="save-btn">Save</button>
        </form>
    </div>

    <div class="footer">
        <a href="tasks.html" class="footer-icon" aria-label="Back">
            <img src="/BeeMazing-Y1/mobile/1-Home/BackBtn.png" alt="Back" style="width: 40px; height: 40px;" />
            <span></span>
        </a>
    </div>

    <!-- Modals -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <h3>Choose User</h3>
            <ul id="userList"></ul>
            <button class="close-btn" id="closeUserModal">Close</button>
        </div>
    </div>
    <div class="modal" id="roomModal">
        <div class="modal-content">
            <h3>Choose Room</h3>
            <ul>
                <li data-value="Entire Home">Entire Home</li>
                <li data-value="Living Room">Living Room</li>
                <li data-value="Bedroom">Bedroom</li>
                <li data-value="Kitchen">Kitchen</li>
                <li data-value="Bathroom">Bathroom</li>
                <li data-value="Laundry">Laundry</li>
                <li data-value="Garden">Garden</li>
                <li data-value="Outside">Outside</li>
                <li data-value="Other">Other</li>
            </ul>
        </div>
    </div>
    <div class="modal" id="repeatModal">
        <div class="modal-content">
            <h3>Choose Repeat</h3>
            <ul>
                <li data-value="Daily">Daily</li>
                <li data-value="Weekly">Weekly</li>
                <li data-value="Monthly">Monthly</li>
            </ul>
        </div>
    </div>
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <h3>Choose Settings</h3>
            <ul>
                <li data-value="Rotation">Rotation</li>
                <li data-value="Team Work">Team Work</li>
                <li data-value="Individual">Individual</li>
            </ul>
        </div>
    </div>

    <div class="modal" id="timesPerDayModal">
        <div class="modal-content fancy-modal">
            <h3>How many times per day?</h3>
            <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0;">
                <button class="btn-save" data-value="1">1</button>
                <button class="btn-save" data-value="2">2</button>
                <button class="btn-save" data-value="3">3</button>
                <button class="btn-save" data-value="4">4</button>
                <button class="btn-save" data-value="5">5</button>
            </div>
            <input type="number" id="customTimesInput" placeholder="Or enter your own" min="1" class="fancy-input smaller-input">
            <div style="margin-top: 10px;">
                <button id="saveCustomTimesBtn" class="btn-save">Save</button>
                <button class="btn-cancel" id="closeTimesModal">Cancel</button>
            </div>
        </div>
    </div>

    <div class="modal" id="timesPerWeekModal">
        <div class="modal-content fancy-modal">
            <h3>How many times per week?</h3>
            <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0;">
                <button class="btn-save" data-value="1">1</button>
                <button class="btn-save" data-value="2">2</button>
                <button class="btn-save" data-value="3">3</button>
                <button class="btn-save" data-value="4">4</button>
                <button class="btn-save" data-value="5">5</button>
            </div>
            <input type="number" id="customTimesWeekInput" placeholder="Or enter your own" min="1" class="fancy-input smaller-input">
            <div style="margin-top: 10px;">
                <button id="saveCustomTimesWeekBtn" class="btn-save">Save</button>
                <button id="closeTimesWeekModal" class="btn-cancel">Cancel</button>
            </div>
        </div>
    </div>
    
<div class="modal" id="timesPerMonthModal">
    <div class="modal-content fancy-modal">
        <h3>How many times per month?</h3>
        <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin: 10px 0;">
            <button class="btn-save" data-value="1">1</button>
            <button class="btn-save" data-value="2">2</button>
            <button class="btn-save" data-value="3">3</button>
            <button class="btn-save" data-value="4">4</button>
            <button class="btn-save" data-value="5">5</button>
        </div>
        <input type="number" id="customTimesMonthInput" placeholder="Or enter your own" min="1" class="fancy-input smaller-input">
        <div style="margin-top: 10px;">
            <button id="saveCustomTimesMonthBtn" class="btn-save">Save</button>
            <button id="closeTimesMonthModal" class="btn-cancel">Cancel</button>
        </div>
    </div>
</div>
    

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>

document.addEventListener("DOMContentLoaded", () => {
    const editTask = JSON.parse(localStorage.getItem("familyApp_editTask"));

    if (editTask) {
        document.getElementById("taskTitle").value = editTask.title || "";
        document.getElementById("taskNotes").value = editTask.notes || "";
        document.getElementById("roomSelection").value = editTask.room || "";
        document.getElementById("selectRoom").textContent = editTask.room || "Select";

        document.getElementById("repeatSelection").value = editTask.repeat || "";
        document.getElementById("selectRepeat").textContent = editTask.repeat || "Select";

        document.getElementById("settingsSelection").value = editTask.settings || "";
        document.getElementById("selectSettings").textContent = editTask.settings || "Select";

        document.getElementById("RewardValue").value = editTask.reward || "";
        document.getElementById("selectReward").textContent = editTask.reward ? `Reward: ${editTask.reward} 🍯` : "Reward";

        document.getElementById("taskReminder").checked = !!editTask.reminder;

        if (editTask.reminder && editTask.alarms) {
            editTask.alarms.forEach(time => {
                const alarmWrapper = document.createElement('div');
                alarmWrapper.style.marginBottom = '10px';
                alarmWrapper.style.display = 'flex';
                alarmWrapper.style.alignItems = 'center';

                const alarmInput = document.createElement('input');
                alarmInput.type = 'time';
                alarmInput.value = time;
                alarmInput.style.marginRight = '10px';
                alarmInput.style.padding = '10px';
                alarmInput.style.border = '2px solid var(--primary-color)';
                alarmInput.style.borderRadius = '8px';
                alarmInput.style.background = 'var(--accent-color)';

                const removeButton = document.createElement('button');
                removeButton.textContent = 'Remove';
                removeButton.className = 'btn-cancel';
                removeButton.addEventListener('click', () => alarmWrapper.remove());

                alarmWrapper.appendChild(alarmInput);
                alarmWrapper.appendChild(removeButton);
                document.getElementById("alarmContainer").appendChild(alarmWrapper);
            });
        }

        if (editTask.date && editTask.date.includes(" to ")) {
            const [from, to] = editTask.date.split(" to ");
            document.getElementById("taskDate").value = from;
            document.getElementById("taskDateTo").value = to;
            document.getElementById("dateDisplay").textContent = new Date(from).toLocaleDateString(undefined, { month: 'long', day: 'numeric' });
            document.getElementById("dateDisplayTo").textContent = new Date(to).toLocaleDateString(undefined, { month: 'long', day: 'numeric' });
            document.getElementById("dateDisplayTo").style.display = "inline-block";
            document.getElementById("dateModeToggle").textContent = "From - To";
            dateMode = "from-to";
        } else {
            document.getElementById("taskDate").value = editTask.date || "";
            document.getElementById("dateDisplay").textContent = new Date(editTask.date).toLocaleDateString(undefined, { month: 'long', day: 'numeric' });
        }

        if (editTask.users) {
            selectedUsers = [...editTask.users];
            updateSelectedUsersDisplay();
        }

        if (editTask.repeat === "Daily" && editTask.timesPerDay) {
            document.getElementById("timesPerDayGroup").style.display = "flex";
            document.getElementById("timesPerDayInput").value = editTask.timesPerDay;
        }
        if (editTask.repeat === "Weekly" && editTask.timesPerWeek) {
            document.getElementById("timesPerWeekGroup").style.display = "flex";
            document.getElementById("timesPerWeekInput").value = editTask.timesPerWeek;
        }
        if (editTask.repeat === "Monthly" && editTask.timesPerMonth) {
            document.getElementById("timesPerMonthGroup").style.display = "flex";
            document.getElementById("timesPerMonthInput").value = editTask.timesPerMonth;
        }
    }
});

















        // Show modal with smooth transition
        function showModal(modal) {
            modal.classList.remove('hide');
            modal.classList.add('show');
            modal.style.display = 'flex';
        }
    
        // Hide modal with smooth transition
        function hideModal(modal) {
            modal.classList.remove('show');
            modal.classList.add('hide');
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }

        function setupTimesModal(inputEl, modalEl, closeBtnEl, customInputEl, saveBtnEl) {
    // Open modal on focus
    inputEl.addEventListener("focus", () => {
        customInputEl.value = "";
        showModal(modalEl);
    });

    // Quick pick buttons
    modalEl.querySelectorAll("button[data-value]").forEach(btn => {
        btn.addEventListener("click", () => {
            inputEl.value = btn.getAttribute("data-value");
            hideModal(modalEl);
        });
    });

    // Save custom value
    saveBtnEl.addEventListener("click", () => {
        let val = parseInt(customInputEl.value.trim());
        if (val && val > 0) {
            val = Math.min(val, 100);
            inputEl.value = val;
            hideModal(modalEl);
        }
    });

    // Close modal
    closeBtnEl.addEventListener("click", () => {
        hideModal(modalEl);
    });
}

    
        // User Modal Logic
        const userModal = document.getElementById("userModal");
        const assignedToDisplay = document.getElementById("assignedToDisplay");
        const userList = document.getElementById("userList");
        const assignedToSelection = document.getElementById("assignedToSelection");
    
        let selectedUsers = [];
        const populateUsers = () => {
            const users = JSON.parse(localStorage.getItem("users")) || [];
            userList.innerHTML = "";
            users.forEach((user) => {
                const userItem = document.createElement("li");
                userItem.textContent = user;
                userItem.style.padding = "10px";
                userItem.style.margin = "5px 0";
                userItem.style.backgroundColor = "var(--light-bg)";
                userItem.style.border = "1px solid var(--selection-border)";
                userItem.style.borderRadius = "8px";
                userItem.style.cursor = "pointer";
                userItem.style.textAlign = "center";
    
                userItem.addEventListener("mouseover", () => {
                    userItem.style.backgroundColor = "var(--primary-color)";
                    userItem.style.color = "var(--secondary-color)";
                });
                userItem.addEventListener("mouseout", () => {
                    if (selectedUsers.includes(user)) {
                        userItem.style.backgroundColor = "var(--primary-color)";
                        userItem.style.color = "var(--secondary-color)";
                    } else {
                        userItem.style.backgroundColor = "var(--light-bg)";
                        userItem.style.color = "var(--text-color)";
                    }
                });
                userItem.addEventListener("click", () => {
                    if (selectedUsers.includes(user)) {
                        selectedUsers = selectedUsers.filter((u) => u !== user);
                        userItem.style.backgroundColor = "var(--light-bg)";
                        userItem.style.color = "var(--text-color)";
                    } else {
                        selectedUsers.push(user);
                        userItem.style.backgroundColor = "var(--primary-color)";
                        userItem.style.color = "var(--secondary-color)";
                    }
                    updateSelectedUsersDisplay();
                });
                userList.appendChild(userItem);
            });
        };
    
        const updateSelectedUsersDisplay = () => {
    // Clean the selectedUsers array just in case
    selectedUsers = selectedUsers.map(u => u.trim()).filter(u => u);

    // Set value and display cleanly
    assignedToSelection.value = selectedUsers.join(", ");
    assignedToDisplay.textContent = selectedUsers.length > 0
        ? `Selected: ${selectedUsers.join(", ")}`
        : "Select users";
};

    
        document.addEventListener("DOMContentLoaded", () => {
            populateUsers();
        });
    
        assignedToDisplay.addEventListener("click", () => {
            showModal(userModal);
        });
    
        window.addEventListener("click", (e) => {
            if (e.target === userModal) {
                hideModal(userModal);
            }
        });
    
        document.getElementById("closeUserModal").addEventListener("click", () => {
            hideModal(userModal);
        });
    
        // Reward Modal Logic
        const rewardModal = document.getElementById("rewardModal");
        const selectRewardButton = document.getElementById("selectReward");
        const rewardValueInput = document.getElementById("RewardValue");
        const rewardInput = document.getElementById("rewardInput");
        const saveRewardButton = document.getElementById("saveRewardBtn");
        const closeRewardButton = document.getElementById("closeRewardModal");
    
        selectRewardButton.addEventListener("click", () => {
            showModal(rewardModal);
        });
    
        saveRewardButton.addEventListener("click", (event) => {
            event.preventDefault();
            const reward = rewardInput.value;
            if (reward) {
                rewardValueInput.value = reward;
                selectRewardButton.textContent = `Reward: ${reward} 🍯`;
            }
            hideModal(rewardModal);
        });
    
        closeRewardButton.addEventListener("click", () => {
            hideModal(rewardModal);
        });
    
        // Generic Modal Setup
        function setupModal(modalId, buttonId, inputId) {
            const modal = document.getElementById(modalId);
            const button = document.getElementById(buttonId);
            const input = document.getElementById(inputId);
    
            button.addEventListener('click', () => {
                showModal(modal);
            });
    
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideModal(modal);
                }
            });
    
            modal.addEventListener('click', (e) => {
                if (e.target.tagName === 'LI') {
                    input.value = e.target.getAttribute('data-value');
                    button.textContent = e.target.getAttribute('data-value');
                    hideModal(modal);
                }
            });
        }
    
        setupModal('roomModal', 'selectRoom', 'roomSelection');
        setupModal('settingsModal', 'selectSettings', 'settingsSelection');

        const repeatModal = document.getElementById('repeatModal');
const repeatButton = document.getElementById('selectRepeat');
const repeatInput = document.getElementById('repeatSelection');
const timesPerDayGroup = document.getElementById('timesPerDayGroup');
const timesPerWeekGroup = document.getElementById('timesPerWeekGroup');
const timesPerMonthGroup = document.getElementById('timesPerMonthGroup');


repeatButton.addEventListener('click', () => {
    showModal(repeatModal);
});

window.addEventListener('click', (e) => {
    if (e.target === repeatModal) {
        hideModal(repeatModal);
    }
});

repeatModal.addEventListener('click', (e) => {
    if (e.target.tagName === 'LI') {
        const selected = e.target.getAttribute('data-value');
        repeatInput.value = selected;
        repeatButton.textContent = selected;
        hideModal(repeatModal);

        // Show/hide correct "x times" group
        timesPerDayGroup.style.display = selected === "Daily" ? "flex" : "none";
        timesPerWeekGroup.style.display = selected === "Weekly" ? "flex" : "none";
        timesPerMonthGroup.style.display = selected === "Monthly" ? "flex" : "none";

        // Set initial value to 1
        if (selected === "Daily") timesPerDayInput.value = "1";
        if (selected === "Weekly") document.getElementById("timesPerWeekInput").value = "1";
        if (selected === "Monthly") document.getElementById("timesPerMonthInput").value = "1";
    }
});


const timesPerDayInput = document.getElementById("timesPerDayInput");
const timesPerDayModal = document.getElementById("timesPerDayModal");
const closeTimesModal = document.getElementById("closeTimesModal");
const saveCustomTimesBtn = document.getElementById("saveCustomTimesBtn");
const customTimesInput = document.getElementById("customTimesInput");

// Open modal when input clicked
timesPerDayInput.addEventListener("focus", () => {
    customTimesInput.value = ""; // Clear previous custom input
    showModal(timesPerDayModal);
});


// Quick pick buttons (1–5)
timesPerDayModal.querySelectorAll("button[data-value]").forEach(btn => {
    btn.addEventListener("click", () => {
        timesPerDayInput.value = btn.getAttribute("data-value");
        hideModal(timesPerDayModal);
    });
});

// Custom input save
saveCustomTimesBtn.addEventListener("click", () => {
    let val = customTimesInput.value.trim();
    if (val && parseInt(val) > 0) {
        val = Math.min(parseInt(val), 100); // cap at 100
        timesPerDayInput.value = val;
        hideModal(timesPerDayModal);
    }
});


// Close modal
closeTimesModal.addEventListener("click", () => {
    hideModal(timesPerDayModal);
});


setupTimesModal(
    document.getElementById("timesPerMonthInput"),
    document.getElementById("timesPerMonthModal"),
    document.getElementById("closeTimesMonthModal"),
    document.getElementById("customTimesMonthInput"),
    document.getElementById("saveCustomTimesMonthBtn")
);

// Close times modals when clicking outside
window.addEventListener('click', (e) => {
    if (e.target === timesPerDayModal) hideModal(timesPerDayModal);
    if (e.target === document.getElementById("timesPerWeekModal")) hideModal(document.getElementById("timesPerWeekModal"));
    if (e.target === document.getElementById("timesPerMonthModal")) hideModal(document.getElementById("timesPerMonthModal"));
});




    
        // Date Mode Toggle Logic
        let dateMode = "from";
        const dateDisplay = document.getElementById("dateDisplay");
        const dateDisplayTo = document.getElementById("dateDisplayTo");
        const dateInputFrom = document.getElementById("taskDate");
        const dateInputTo = document.getElementById("taskDateTo");
        const toggleButton = document.getElementById("dateModeToggle");
    
        toggleButton.addEventListener("click", () => {
            if (dateMode === "from") {
                dateMode = "from-to";
                toggleButton.textContent = "From - To";
                dateDisplayTo.style.display = "inline-block";
            } else {
                dateMode = "from";
                toggleButton.textContent = "From";
                dateDisplayTo.style.display = "none";
                dateInputTo.value = "";
                dateDisplayTo.textContent = "To Date";
            }
        });
    
        const flatpickrFrom = flatpickr("#taskDate", {
            dateFormat: "Y-m-d",
            defaultDate: "today",
            disableMobile: true,
            onChange: function (selectedDates) {
                const formatted = new Date(selectedDates[0]).toLocaleDateString(undefined, { month: 'long', day: 'numeric' });
                dateDisplay.textContent = formatted;
            },
            positionElement: dateDisplay,
            appendTo: document.body
        });
    
        const flatpickrTo = flatpickr("#taskDateTo", {
            dateFormat: "Y-m-d",
            disableMobile: true,
            onChange: function (selectedDates) {
                const formatted = new Date(selectedDates[0]).toLocaleDateString(undefined, { month: 'long', day: 'numeric' });
                dateDisplayTo.textContent = formatted;
            },
            positionElement: dateDisplayTo,
            appendTo: document.body
        });
    
        dateDisplay.addEventListener("click", () => {
            flatpickrFrom.open();
        });
    
        dateDisplayTo.addEventListener("click", () => {
            if (dateMode === "from-to") {
                flatpickrTo.open();
            }
        });
    
        // Reminder and Alarm Logic
        const reminderToggle = document.getElementById('taskReminder');
        const addAlarmBtn = document.getElementById('addAlarmBtn');
        const alarmContainer = document.getElementById('alarmContainer');
        let alarms = [];
    
        reminderToggle.addEventListener('change', () => {
            if (reminderToggle.checked) {
                addAlarmBtn.style.display = 'inline-block';
            } else {
                addAlarmBtn.style.display = 'none';
                alarmContainer.innerHTML = '';
                alarms = [];
            }
        });
    
        addAlarmBtn.addEventListener('click', () => {
            const alarmWrapper = document.createElement('div');
            alarmWrapper.style.marginBottom = '10px';
            alarmWrapper.style.display = 'flex';
            alarmWrapper.style.alignItems = 'center';
    
            const alarmInput = document.createElement('input');
            alarmInput.type = 'time';
            alarmInput.style.marginRight = '10px';
            alarmInput.style.padding = '10px';
            alarmInput.style.border = '2px solid var(--primary-color)';
            alarmInput.style.borderRadius = '8px';
            alarmInput.style.background = 'var(--accent-color)';
    
            const removeButton = document.createElement('button');
            removeButton.textContent = 'Remove';
            removeButton.style.padding = '5px 10px';
            removeButton.style.backgroundColor = 'var(--danger-color)';
            removeButton.style.color = 'var(--accent-color)';
            removeButton.style.border = 'none';
            removeButton.style.borderRadius = '8px';
    
            removeButton.addEventListener('click', () => {
                alarmWrapper.remove();
                alarms = alarms.filter(a => a !== alarmInput.value);
            });
    
            alarmInput.addEventListener('input', () => {
                if (!alarms.includes(alarmInput.value)) {
                    alarms.push(alarmInput.value);
                }
            });
    
            alarmWrapper.appendChild(alarmInput);
            alarmWrapper.appendChild(removeButton);
            alarmContainer.appendChild(alarmWrapper);
        });
    
        // Form Submission
        document.getElementById("addTaskForm").addEventListener("submit", function (event) {
            event.preventDefault();
    
            const title = document.getElementById("taskTitle").value.trim();
            const notes = document.getElementById("taskNotes").value.trim();
            const room = document.getElementById("roomSelection").value;
            const repeat = document.getElementById("repeatSelection").value;
            const settings = document.getElementById("settingsSelection").value;
            const dateFrom = document.getElementById("taskDate").value;
            const dateTo = document.getElementById("taskDateTo").value;
            const reminder = document.getElementById("taskReminder").checked;
            const users = document.getElementById("assignedToSelection").value
    .split(",")
    .map(u => u.trim())
    .filter(u => u);

            const reward = document.getElementById("RewardValue").value;
            let timesPerDay = parseInt(document.getElementById("timesPerDayInput").value) || null;
let timesPerWeek = parseInt(document.getElementById("timesPerWeekInput").value) || null;
let timesPerMonth = parseInt(document.getElementById("timesPerMonthInput").value) || null;

// Cap values at 100
if (timesPerDay > 100) timesPerDay = 100;
if (timesPerWeek > 100) timesPerWeek = 100;
if (timesPerMonth > 100) timesPerMonth = 100;
// Ensure values are at least 1 (if not null)
if (timesPerDay !== null && timesPerDay < 1) timesPerDay = 1;
if (timesPerWeek !== null && timesPerWeek < 1) timesPerWeek = 1;
if (timesPerMonth !== null && timesPerMonth < 1) timesPerMonth = 1;




    
            if (!title) {
                alert("Task title is required!");
                return;
            }
    
            const dateValue = dateMode === "from" ? dateFrom : `${dateFrom} to ${dateTo}`;
            const tasks = JSON.parse(localStorage.getItem("familyApp_tasks")) || [];
            const editTask = JSON.parse(localStorage.getItem("familyApp_editTask"));
if (editTask) {
    // Replace existing task by title + date match
    const index = tasks.findIndex(t => t.title === editTask.title && t.date === editTask.date);
    if (index !== -1) {
        tasks[index] = {
            title, notes, room, repeat, settings,
            date: dateValue, reminder, users, reward, alarms,
            timesPerDay, timesPerWeek, timesPerMonth
        };
    }
    localStorage.removeItem("familyApp_editTask");
} else {
    // New task
    tasks.push({
        title, notes, room, repeat, settings,
        date: dateValue, reminder, users, reward, alarms,
        timesPerDay, timesPerWeek, timesPerMonth
    });
}


localStorage.setItem("familyApp_tasks", JSON.stringify(tasks));

    
            alert("Task saved successfully!");
            window.location.href = "tasks.html";
        });
    </script>    
</body>
</html>